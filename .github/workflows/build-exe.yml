name: 构建 EXE 可执行文件

on:
  push:
    branches: [ main ]  # 触发分支，可根据需要修改
  pull_request:
    branches: [ main ]
    workflow_dispatch: # 手动触发

jobs:
  build:
    runs-on: windows-latest  # 构建 Windows 可执行文件需用 Windows 环境

    steps:
    - name: 检出代码
      uses: actions/checkout@v4

    - name: 安装 Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20.x  # 根据项目需求指定 Node.js 版本
        cache: 'yarn'       # 缓存 Yarn 依赖加速构建

    - name: 安装项目依赖
      run: yarn install --frozen-lockfile  # 锁定依赖版本，确保一致性

    - name: 安装打包工具 pkg
      run: yarn global add pkg  # 全局安装 pkg（若项目已局部依赖可省略）

    - name: 编译并打包为 EXE
      run: |
        # 确保项目有入口文件（如 index.js），根据实际情况修改
        pkg . --targets node18-win-x64 --output dist/my-app.exe
      env:
        # 若项目需要环境变量可在此添加
        NODE_ENV: production

    - name: 上传 EXE 产物
      uses: actions/upload-artifact@v4
      with:
        name: my-app-exe
        path: dist/my-app.exe  # 对应上面打包输出的路径
